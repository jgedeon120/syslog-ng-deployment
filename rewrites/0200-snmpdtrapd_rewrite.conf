rewrite r_snmptrapd {
    # Remove the newline from the message
    subst("\n"," ", value("MESSAGE"), flags("global"));
    # Capture the hostname and set the message to just the relevant part
    subst('^[^\s]+\s[^\s]+\s+(?:.+?)?UDP:\s\[([^\]]+)\]:.+?:162(?:\)|\]:?)\s(.+)', "${2}", value("MESSAGE")
    type("pcre"), flags("store-matches"));
    # Set the host to the correct hostname
    set("${1}" value("HOST"));
};
